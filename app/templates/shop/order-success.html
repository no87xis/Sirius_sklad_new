{% extends "shop/base.html" %}

{% block title %}–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="text-center mb-8">
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4">
                <svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            </div>
            <h1 class="text-3xl font-bold text-gray-900 mb-2">–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ!</h1>
            <p class="text-lg text-gray-600">–í–∞—à –∑–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è</p>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–∞—Ö -->
        {% for order in orders %}
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex items-start justify-between mb-4">
                <div>
                    <h2 class="text-xl font-semibold text-gray-900 mb-2">{{ order.product_name }}</h2>
                    <p class="text-gray-600">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {{ order.quantity }}</p>
                    <p class="text-gray-600">–°—Ç–æ–∏–º–æ—Å—Ç—å: {{ order.total_amount }} ‚ÇΩ</p>
                </div>
                <div class="text-right">
                    <div class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">
                        {{ order.status }}
                    </div>
                </div>
            </div>

            <!-- –ö–æ–¥ –∑–∞–∫–∞–∑–∞ -->
            <div class="bg-gray-50 rounded-lg p-4 mb-4">
                <h3 class="text-lg font-medium text-gray-900 mb-2">–í–∞—à –∫–æ–¥ –∑–∞–∫–∞–∑–∞</h3>
                <div class="flex items-center space-x-3">
                    <code class="bg-white px-3 py-2 rounded border text-lg font-mono text-gray-800">
                        {{ order.order_code }}
                    </code>
                    <button 
                        onclick="copyToClipboard('{{ order.order_code }}')"
                        class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors"
                    >
                        –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </div>
                <p class="text-sm text-gray-600 mt-2">
                    –¢–æ–ª—å–∫–æ –ø–æ –Ω–µ–º—É –≤—ã —Å–º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä.
                </p>
            </div>

            <!-- QR-–∫–æ–¥ -->
            {% if order.has_qr %}
            <div class="bg-gray-50 rounded-lg p-4 mb-4">
                <h3 class="text-lg font-medium text-gray-900 mb-3">QR-–∫–æ–¥ –∑–∞–∫–∞–∑–∞</h3>
                <div class="flex flex-col sm:flex-row items-start sm:items-center space-y-3 sm:space-y-0 sm:space-x-4">
                    <div class="bg-white p-3 rounded-lg border">
                        <img 
                            src="{{ qr_service.get_qr_image_url(order) }}" 
                            alt="QR-–∫–æ–¥ –∑–∞–∫–∞–∑–∞ {{ order.order_code }}"
                            class="w-32 h-32"
                        />
                    </div>
                    <div class="flex flex-col space-y-2">
                        <button 
                            onclick="downloadQR('{{ order.order_code }}', '{{ qr_service.get_qr_image_url(order) }}')"
                            class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors"
                        >
                            üì• –°–∫–∞—á–∞—Ç—å QR-–∫–æ–¥
                        </button>
                        <button 
                            onclick="shareQR('{{ order.order_code }}')"
                            class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 transition-colors"
                        >
                            üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
                        </button>
                        <button 
                            onclick="copyQRForWhatsApp('{{ order.order_code }}', '{{ qr_service.get_qr_public_url(order) }}')"
                            class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition-colors"
                        >
                            üì± –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è WhatsApp
                        </button>
                    </div>
                </div>
                <p class="text-sm text-gray-600 mt-3">
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ QR-–∫–æ–¥ ‚Äî –ø–æ–∫–∞–∂–∏—Ç–µ –µ–≥–æ –Ω–∞ —Å–∫–ª–∞–¥–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞.
                </p>
            </div>
            {% endif %}

            <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞–∫–∞–∑ -->
            <div class="bg-blue-50 rounded-lg p-4 mb-4">
                <h3 class="text-lg font-medium text-gray-900 mb-2">–°—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞–∫–∞–∑</h3>
                <div class="flex items-center space-x-3">
                    <input 
                        type="text" 
                        value="{{ request.base_url }}shop/order/{{ order.order_code }}" 
                        readonly
                        class="flex-1 bg-white px-3 py-2 rounded border text-gray-800"
                    />
                    <button 
                        onclick="copyToClipboard('{{ request.base_url }}shop/order/{{ order.order_code }}')"
                        class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors"
                    >
                        –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}

        <!-- WhatsApp –∫–æ–Ω—Ç–∞–∫—Ç—ã -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h3 class="text-lg font-medium text-gray-900 mb-4">–°–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º</h3>
            <div class="space-y-3">
                <p class="text-gray-600">
                    –î–ª—è –æ–ø–ª–∞—Ç—ã –∏ —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π –Ω–∞–ø–∏—à–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä—É –≤ WhatsApp:
                </p>
                <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
                    <a 
                        href="https://wa.me/79993980159"
                        target="_blank"
                        class="inline-flex items-center justify-center bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition-colors"
                    >
                        üì± +7 999 398-01-59
                    </a>
                    <a 
                        href="https://wa.me/375293571197"
                        target="_blank"
                        class="inline-flex items-center justify-center bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition-colors"
                    >
                        üì± +375 29 357-11-97
                    </a>
                </div>
                <button 
                    onclick="openWhatsApp('{{ orders[0].order_code if orders else '' }}')"
                    class="w-full bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors font-medium"
                >
                    üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä—É –≤ WhatsApp
                </button>
            </div>
        </div>

        <!-- –ß—Ç–æ –¥–∞–ª—å—à–µ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h3 class="text-lg font-medium text-gray-900 mb-4">–ß—Ç–æ –¥–∞–ª—å—à–µ?</h3>
            <div class="space-y-3 text-gray-600">
                <p>–°–≤—è–∂–∏—Ç–µ—Å—å —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º –¥–ª—è –æ–ø–ª–∞—Ç—ã –∑–∞–∫–∞–∑–∞</p>
                <p>–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã, —Ç–æ–≤–∞—Ä—ã –º–æ–∂–Ω–æ –∑–∞–±—Ä–∞—Ç—å –Ω–∞ —Å–∫–ª–∞–¥–µ –∏–ª–∏ –∑–∞–∫–∞–∑–∞—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É</p>
            </div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–∑–µ—Ä–≤–µ -->
        <div class="bg-yellow-50 rounded-lg p-4 mb-6">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div class="ml-3">
                    <p class="text-sm text-yellow-800">
                        –¢–æ–≤–∞—Ä—ã —Ä–µ–∑–µ—Ä–≤–∏—Ä—É—é—Ç—Å—è –Ω–∞ 48 —á–∞—Å–æ–≤. –í —Å–ª—É—á–∞–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –æ–ø–ª–∞—Ç—ã —Ä–µ–∑–µ—Ä–≤ —Å–Ω–∏–º–∞–µ—Ç—Å—è.
                    </p>
                </div>
            </div>
        </div>

        <!-- –ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–∞ -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h3 class="text-lg font-medium text-gray-900 mb-4">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ–π –∑–∞–∫–∞–∑</h3>
            <form action="/shop/search-order" method="GET" class="space-y-4">
                <div>
                    <label for="order_code" class="block text-sm font-medium text-gray-700 mb-1">
                        –ö–æ–¥ –∑–∞–∫–∞–∑–∞
                    </label>
                    <input 
                        type="text" 
                        id="order_code" 
                        name="order_code" 
                        placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∑–∞–∫–∞–∑–∞"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        required
                    />
                </div>
                <div>
                    <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">
                        –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                    </label>
                    <input 
                        type="tel" 
                        id="phone" 
                        name="phone" 
                        placeholder="+7 (XXX) XXX-XX-XX"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        required
                    />
                </div>
                <button 
                    type="submit"
                    class="w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium"
                >
                    –ù–∞–π—Ç–∏ –∑–∞–∫–∞–∑
                </button>
            </form>
        </div>
    </div>
</div>

<script>
// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å QR-–∫–æ–¥–∞–º–∏ –∏ WhatsApp

function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        showNotification('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
    }).catch(() => {
        showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å', 'error');
    });
}

function downloadQR(orderCode, qrUrl) {
    const link = document.createElement('a');
    link.href = qrUrl;
    link.download = `qr-order-${orderCode}.png`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    showNotification('QR-–∫–æ–¥ —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è...', 'success');
}

function shareQR(orderCode) {
    if (navigator.share) {
        navigator.share({
            title: `QR-–∫–æ–¥ –∑–∞–∫–∞–∑–∞ ${orderCode}`,
            text: `QR-–∫–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ ${orderCode}`,
            url: window.location.href
        }).then(() => {
            showNotification('–ü–æ–¥–µ–ª–∏–ª–∏—Å—å —É—Å–ø–µ—à–Ω–æ!', 'success');
        }).catch(() => {
            showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–µ–ª–∏—Ç—å—Å—è', 'error');
        });
    } else {
        copyToClipboard(window.location.href);
        showNotification('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
    }
}

function copyQRForWhatsApp(orderCode, qrUrl) {
    const message = `üõç –ó–∞–∫–∞–∑ –≤ –º–∞–≥–∞–∑–∏–Ω–µ SIRIUS_GROUPE\n\nüìã –ö–æ–¥ –∑–∞–∫–∞–∑–∞: ${orderCode}\nüîó –°—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞–∫–∞–∑: ${window.location.origin}/shop/order/${orderCode}\nüì± QR-–∫–æ–¥: ${window.location.origin}${qrUrl}\n\n–î–ª—è –æ–ø–ª–∞—Ç—ã –Ω–∞–ø–∏—à–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä—É –≤ WhatsApp.`;
    
    navigator.clipboard.writeText(message).then(() => {
        showNotification('–¢–µ–∫—Å—Ç –¥–ª—è WhatsApp —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!', 'success');
    }).catch(() => {
        showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å', 'error');
    });
}

function openWhatsApp(orderCode) {
    const message = `üõç –ó–∞–∫–∞–∑ –≤ –º–∞–≥–∞–∑–∏–Ω–µ SIRIUS_GROUPE\n\nüìã –ö–æ–¥ –∑–∞–∫–∞–∑–∞: ${orderCode}\nüîó –°—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞–∫–∞–∑: ${window.location.origin}/shop/order/${orderCode}\n\n–î–ª—è –æ–ø–ª–∞—Ç—ã –Ω–∞–ø–∏—à–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä—É –≤ WhatsApp.`;
    const encodedMessage = encodeURIComponent(message);
    const whatsappUrl = `https://wa.me/375293571197?text=${encodedMessage}`;
    window.open(whatsappUrl, '_blank');
}

function showNotification(message, type) {
    // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-medium z-50 ${
        type === 'success' ? 'bg-green-500' : 'bg-red-500'
    }`;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    // –£–±–∏—Ä–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 3000);
}

// –ú–∞—Å–∫–∞ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
document.addEventListener('DOMContentLoaded', function() {
    const phoneInput = document.getElementById('phone');
    if (phoneInput) {
        phoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 0) {
                if (value.length <= 3) {
                    value = '+7 (' + value;
                } else if (value.length <= 6) {
                    value = '+7 (' + value.substring(0, 3) + ') ' + value.substring(3);
                } else if (value.length <= 8) {
                    value = '+7 (' + value.substring(0, 3) + ') ' + value.substring(3, 6) + '-' + value.substring(6);
                } else {
                    value = '+7 (' + value.substring(0, 3) + ') ' + value.substring(3, 6) + '-' + value.substring(6, 8) + '-' + value.substring(8, 10);
                }
            }
            e.target.value = value;
        });
    }
});
</script>
{% endblock %}
