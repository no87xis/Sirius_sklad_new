#!/bin/bash

echo "๐ Sirius Group - ะััััะพะต ะธัะฟัะฐะฒะปะตะฝะธะต ะฑะฐะทั ะดะฐะฝะฝัั"
echo "=================================================="

# ะะตัะตัะพะดะธะผ ะฒ ะฟะฐะฟะบั ะฟัะพะตะบัะฐ
cd Sirius_sklad_new

# ะะบัะธะฒะธััะตะผ ะฒะธัััะฐะปัะฝะพะต ะพะบััะถะตะฝะธะต
source venv/bin/activate

# ะะฐะฟััะบะฐะตะผ ะธัะฟัะฐะฒะปะตะฝะฝัะน ัะบัะธะฟั ะธะฝะธัะธะฐะปะธะทะฐัะธะธ
echo "๐ง ะะฐะฟััะบะฐะตะผ ะธัะฟัะฐะฒะปะตะฝะฝัั ะธะฝะธัะธะฐะปะธะทะฐัะธั..."
python3 fix_init.py

if [ $? -eq 0 ]; then
    echo "โ ะะฐะทะฐ ะดะฐะฝะฝัั ะธัะฟัะฐะฒะปะตะฝะฐ!"
    echo "๐ ะะฐะฟััะบะฐะตะผ ัะตัะฒะตั..."
    
    # ะะฐะฟััะบะฐะตะผ ัะตัะฒะตั
    nohup python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000 > server.log 2>&1 &
    
    # ะัะพะฒะตััะตะผ ััะฐััั
    sleep 5
    if pgrep -f "uvicorn" > /dev/null; then
        echo "โ ะกะตัะฒะตั ะทะฐะฟััะตะฝ ััะฟะตัะฝะพ!"
        echo "๐ ะกะฐะนั: http://185.239.50.157:8000"
        echo "๐ค ะะดะผะธะฝ: admin / admin123"
        echo "๐ ะะพะณ: tail -f server.log"
    else
        echo "โ ะัะธะฑะบะฐ ะทะฐะฟััะบะฐ ัะตัะฒะตัะฐ"
        echo "๐ ะัะพะฒะตัััะต ะปะพะณ:"
        tail -20 server.log
    fi
else
    echo "โ ะัะธะฑะบะฐ ะธัะฟัะฐะฒะปะตะฝะธั ะฑะฐะทั ะดะฐะฝะฝัั"
fi
